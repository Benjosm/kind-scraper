#!/usr/bin/env node
const { program } = require('commander');
const { scrapePage } = require('../lib/scrape');

program
  .version('0.1.0', '-v, --version')
  .command('scrape <url>')
  .description('Scrape a webpage and output structured JSON data')
  .action(async (url) => {
    try {
      new URL(url);
    } catch (e) {
      console.error(`Error: Invalid URL format - ${e.message}`);
      process.exit(1);
    }

    try {
      const data = await scrapePage(url);
      console.log(JSON.stringify(data));
    } catch (error) {
      console.error(`Error: ${error.message}`);
      process.exit(1);
    }
  });

program.parse(process.argv);

if (!process.argv.slice(2).length) {
  program.outputHelp();
}
