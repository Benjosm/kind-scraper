#!/usr/bin/env node

const { Command } = require('commander');
const { scrapePage } = require('../lib/scraper.js');

const program = new Command();

program
  .version('0.1.0')
  .exitOverride()
  .command('scrape <url>')
  .description('Scrape a webpage for title and first 3 links')
  .action(async (url) => {
    try {
      const result = await scrapePage(url);
      console.log(JSON.stringify(result));
    } catch (error) {
      // Log the error message to stderr without exposing stack traces
      // Ensure error messages start with "Error: "
      const errorMessage = error.message.startsWith('Error: ') ? error.message : `Error: ${error.message}`;
      console.error(errorMessage);
      // Exit with non-zero code
      process.exit(1);
    }
  });

try {
  program.parse(process.argv);
} catch (error) {
  // Catch command parsing errors (e.g., invalid usage, unknown commands)
  if (error.code !== 'commander.helpDisplayed') {
    console.error(`Error: ${error.message}`);
  }
  process.exit(1);
}
